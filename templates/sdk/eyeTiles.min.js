const offset={x:0,y:0};function createCalibrator(className,textContent){var calibrator=document.createElement("div");return calibrator.className=className,calibrator.textContent=textContent,calibrator}const latchCalibrator={};function checkCalibrator(class_name,check){return class_name in latchCalibrator||(latchCalibrator[class_name]=!1),latchCalibrator[class_name]||(check?(latchCalibrator[class_name]=check,latchCalibrator[class_name]):void 0)}function resetCalibrators(){for(const latchKey in latchCalibrator)latchCalibrator[latchKey]=!0}function setOffset(x,y){offset.x=x,offset.y=y}function create_instruction_box(name){var instruct_body=document.createElement("div"),instruction=(instruct_body.className="instruct_body",document.createElement("div")),arrow=(instruction.className="instruction",instruction.innerText="Look there",document.createElement("div"));arrow.className="arrow arrow_"+name,arrow.style.position="fixed";for(let i=0;i<3;i++)arrow.appendChild(document.createElement("span"));return instruct_body.appendChild(instruction),instruct_body.appendChild(arrow),instruct_body}function display_calibrator(name){var element=createCalibrator("calibrator calibrator_"+name+" message-"+name,"Move cursor here"),name=create_instruction_box(name),background=document.createElement("div");background.className="calibration_background",document.body.appendChild(name),document.body.appendChild(element),document.body.appendChild(background)}function remove_calibrator(name){name=document.getElementsByClassName("calibrator_"+name);0<name.length&&name[0].remove(),0<(name=document.getElementsByClassName("instruct_body")).length&&name[0].remove(),0<(name=document.getElementsByClassName("calibration_background")).length&&name[0].remove(),document.getElementsByClassName("calibration_background")}var calibration_counter=0,calibration_sequence=[],startTimestamp=Date.now();const MIN_TIME_WAIT=2e3;function calibrator(x,y,fix){if(calibration_counter>=calibration_sequence.length&&0<calibration_sequence.length)return!0;var side_horizontal,side_vertical,width=window.innerWidth||document.documentElement.clientWidth,height=window.innerHeight||document.documentElement.clientHeight,fix=.2<fix;0==calibration_sequence.length&&(console.log(x,width,side_horizontal),side_vertical=height/2<y,(side_horizontal=width/2<x)?(calibration_sequence.push("right"),calibration_sequence.push("left")):(calibration_sequence.push("left"),calibration_sequence.push("right")),side_vertical?(calibration_sequence.push("bottom"),calibration_sequence.push("top")):(calibration_sequence.push("top"),calibration_sequence.push("bottom")),display_calibrator(calibration_sequence[calibration_counter]));let ret_val=!1;return calibration_counter<=calibration_sequence.length&&("left"==calibration_sequence[calibration_counter]?ret_val=checkCalibrator(".calibrator_"+calibration_sequence[calibration_counter],x<=160&&fix&&Date.now()-startTimestamp>MIN_TIME_WAIT):"right"==calibration_sequence[calibration_counter]?ret_val=checkCalibrator(".calibrator_"+calibration_sequence[calibration_counter],width-160<=x&&fix&&Date.now()-startTimestamp>MIN_TIME_WAIT):"bottom"==calibration_sequence[calibration_counter]?ret_val=checkCalibrator(".calibrator_"+calibration_sequence[calibration_counter],height-160<=y&&fix&&Date.now()-startTimestamp>MIN_TIME_WAIT):"top"==calibration_sequence[calibration_counter]&&(ret_val=checkCalibrator(".calibrator_"+calibration_sequence[calibration_counter],y<=160&&fix&&Date.now()-startTimestamp>MIN_TIME_WAIT))),ret_val&&(remove_calibrator(calibration_sequence[calibration_counter]),calibration_counter+=1,startTimestamp=Date.now(),calibration_counter<calibration_sequence.length)&&display_calibrator(calibration_sequence[calibration_counter]),calibration_counter>=calibration_sequence.length}function checkCalibration(x,y,fix){var width=window.innerWidth||document.documentElement.clientWidth,height=window.innerHeight||document.documentElement.clientHeight,fix=.2<fix;return[checkCalibrator(".calibrator_left",x<=160&&fix),checkCalibrator(".calibrator_right",width-160<=x&&fix),checkCalibrator(".calibrator_top",y<=160&&fix),checkCalibrator(".calibrator_bottom",height-160<=y&&fix)]}function createVideoElement(){var video=document.createElement("video");return video.id="localVideo",video.width=360,video.height=240,video.autoplay=!0,video.muted=!0,video.hidden=!0,video.style.width="auto",video.style.height="auto",video}function createTransportCanvas(){return(trasnportCanvas=document.createElement("canvas")).width=640,trasnportCanvas.height=360,trasnportCanvas}function createSocket(){var addr="http://{{domain}}";return console.log("connecting to: "+addr),io.connect(addr)}function EyeGestureApi(API_KEY,thresh,radius,options={}){const{display_width=document.body.clientWidth-75,display_height=document.body.clientHeight-75,onFrame=function(video){},calibration=!0,DEBUG=!1}=options;var unique_id="{{unique_id}}";const video=createVideoElement(),trasnportCanvas=(document.body.appendChild(video),createTransportCanvas());var socket=createSocket();navigator.mediaDevices.getUserMedia({video:!0}).then(function(stream){calibration&&socket.emit("/api/startCalibration",{key:API_KEY,unique_id:unique_id}),function(video,stream){video.srcObject=stream,video.play()}(video,stream);setInterval(loop,1e3/15)}).catch(function(error){console.error("Error accessing the camera and microphone:",error)}),socket.on("/api/onConnect",function(){console.log("/api/onConnect"),document.body.style.maxWidth=document.body.clientWidth,document.body.style.maxHeight=document.body.clientHeight;var payload={key:API_KEY,width:display_width,height:display_height,unique_id:unique_id,thresh:thresh,radius:radius};socket.emit("/api/clientData",payload)});function loop(){var image;trasnportContext=trasnportCanvas.getContext("2d"),DEBUG?((image=new Image).src="/demo_pic/debug_face.jpg",trasnportContext.drawImage(image,0,0,trasnportCanvas.width,trasnportCanvas.height),onFrame(image)):(trasnportContext.drawImage(video,0,0,trasnportCanvas.width,trasnportCanvas.height),onFrame(video)),image=trasnportCanvas.toDataURL("image/jpeg",.8),socket.emit("/api/stream",{key:API_KEY,unique_id:unique_id,thresh:thresh,radius:radius,height:display_height,width:display_width,offset_x:offset.x,offset_y:offset.y,image:image,timestamp:Date.now()})}socket.on("/api/cursor",function(event){console.log("Data received to cursor")})}function calculateDistance(x1,y1,x2,y2){return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2))}var eyeTilesRun=!0;function EyeMagnetStop(){eyeTilesRun=!1}function EyeMagnetStart(){eyeTilesRun=!0}function EyeTilesAPI(API_KEY,cols_list,options={}){const{fix_point=.1,freeze_radius=500,sightGrid=!0,sightGridColor="#f89c3241",onTile=function(id,fix,blink){console.log("id: ",id," fix: ",fix," blink: ",blink)},display_width=document.body.clientWidth-75,display_height=document.body.clientHeight-75,onCalibration=null,calibration=!0}=options,tiles_list=[];document.addEventListener("DOMContentLoaded",function(){var counter=1,numCols=cols_list.length,i=1,col_width_prcnt=100/numCols;cols_list.forEach(numRows=>{var gridContainer,colContainer=document.createElement("div"),row_height_prcnt=(colContainer.classList.add("container_col"),colContainer.style.width=col_width_prcnt+"%",colContainer.style.height="100%",100/numRows);1==i?colContainer.style.marginLeft="0px":i==numCols&&(colContainer.style.marginRight="0px");for(let j=1;j<=numRows;j++){var tile=document.createElement("div");tile.classList.add("tile"),tile.id="tile_"+counter,tile.style.height=row_height_prcnt+"%",1==j&&(tile.style.marginTop="0px"),j==numRows&&(tile.style.marginBottom="0px"),tiles_list.push(tile),colContainer.appendChild(tile),counter+=1}sightGrid&&((gridContainer=document.getElementById("grid_container")).style.width="100vw",gridContainer.style.height="100vh",gridContainer.style.display="flex",gridContainer.style.position="absolute",gridContainer.appendChild(colContainer)),i+=1})}),sightGrid&&document.addEventListener("DOMContentLoaded",function(){var gridEffect=document.createElement("div"),n_points=(gridEffect.classList.add("card__grid-effect"),200);(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/Android/i))&&(n_points=100,gridEffect.style.gridTemplateColumns="repeat(10, 1fr)");for(let i=1;i<=n_points;i++){var tile=document.createElement("a");tile.classList.add("card__grid-effect-tile"),tile.style.backgroundColor=sightGridColor,tile.href="#",tile.id=i+"_id",gridEffect.appendChild(tile)}document.getElementById("grid_container").appendChild(gridEffect)}),EyeGestureApi(API_KEY,fix_point,freeze_radius,{onCursor:function(x,y,fix,blink){eyeTilesRun&&(sightGrid&&document.querySelectorAll(".card__grid-effect-tile").forEach(grid_spot=>{var rect=grid_spot.getBoundingClientRect(),rect=1/calculateDistance(x,y,rect.x,rect.y)*200;rect<1?(grid_spot.style.width="0.1rem",grid_spot.style.height="0.1rem"):1<rect?(grid_spot.style.width="1rem",grid_spot.style.height="1rem"):(grid_spot.style.width=rect+"rem",grid_spot.style.height=rect+"rem")}),tiles_list.forEach(eyeTile=>{var rect=eyeTile.getBoundingClientRect();rect.x-5<x&&x<rect.x+rect.width+5&&rect.y-5<y&&y<rect.y+rect.height+5&&onTile(eyeTile.id,fix,blink)}))},onCalibration:onCalibration,calibration:calibration,calibration_layout:calibration,display_width:display_width,display_height:display_height})}